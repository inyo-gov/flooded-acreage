<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>flood_app â€“ Flooded Acreage Monitoring</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-89a4cf4abe5adbf5221f4a0509680a92.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../inyo_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Flooded Acreage Monitoring</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Dashboard</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/inyo-gov/flooded-acreage"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<p class="subtitle lead">Blackrock Waterfowl Management Area</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Import necessary libraries authenticate using gcloud api enabled on gcloud project</p>
<div id="cell-1" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 import libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geemap</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geemap.foliumap <span class="im">as</span> geemap</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Trigger authentication</p>
<div id="cell-3" class="cell" data-execution_count="132">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># run this in terminal to authenticate with gcloud &gt;&gt; earthengine authenticate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Initialize Earth Engine</p>
<div id="cell-5" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ee.Initialize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<section id="parameters" class="level1">
<h1>Parameters</h1>
<p>surface reflectance threshold start date the end date is currently start date + 15 days and the first clear scene, low cloud cover will be selected and the image date is used in the reporting and filenaming convention along with the SR threshold value.</p>
<p>Spring 2023</p>
<div id="cell-8" class="cell" data-execution_count="134">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---Mar 2023---730 ac***</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .15</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-02-15'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#---Mar 2023---1604 ac</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .20</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-02-15'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#---May 2023---300 ac</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .15</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-05-01'</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#---May 2023---449 ac</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .20</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-05-01'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Fall 2023</p>
<div id="cell-10" class="cell" data-execution_count="135">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---Oct 2023---1175 ac</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .22</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-10-03'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---Nov 2023---618 ac</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .16</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-11-03'</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#---Nov 2023---760 ac</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .18</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-11-03'</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---Nov 2023---987 ac</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .20</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-11-03'</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#---Nov 2023--- 1125 ac</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .21</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-11-03'</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---Nov 2023---1325 ac***</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .22</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2023-11-03'</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Spring 2024</p>
<div id="cell-12" class="cell" data-execution_count="136">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---Mar 2024---1130 acres***</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .15</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-02-25'</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---Mar 2024---1355 acres***</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .16</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-02-25'</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#---May 2024---</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-05-10'</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .22</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---Jun 2024---92 ac</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-06-01'</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .15</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#---Jun 2024---109 ac</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-06-01'</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .16</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---Jun 2024---109 ac</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># start_date = '2024-06-06'</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = .16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Fall 2024</p>
<div id="cell-14" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">.22</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">'2024-11-04'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Compute the end date by adding days to the start date</p>
<div id="cell-16" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> (datetime.strptime(start_date, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">+</span> timedelta(days<span class="op">=</span><span class="dv">15</span>)).strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Report Directory</p>
<div id="cell-18" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define the bounding box coordinates and create a bounding box geometry</p>
<div id="cell-20" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the bounding box coordinates</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> [[<span class="op">-</span><span class="fl">118.23240736400778</span>, <span class="fl">36.84651455123723</span>],</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        [<span class="op">-</span><span class="fl">118.17232588207419</span>, <span class="fl">36.84651455123723</span>],</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        [<span class="op">-</span><span class="fl">118.17232588207419</span>, <span class="fl">36.924364295139625</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        [<span class="op">-</span><span class="fl">118.23240736400778</span>, <span class="fl">36.924364295139625</span>]]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bounding box geometry</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>bounding_box_geometry <span class="op">=</span> ee.Geometry.Polygon(bbox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Filter sentinel 2 surface reflectance imagery and extract dates, pixel size</p>
<div id="cell-22" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># COPERNICUS/S2_SR_HARMONIZED, allows comparisons between dates compared to S2_SR</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sentinel_collection <span class="op">=</span> ee.ImageCollection(<span class="st">'COPERNICUS/S2_SR_HARMONIZED'</span>) <span class="op">\</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    .filterBounds(bounding_box_geometry) <span class="op">\</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .filterDate(start_date, end_date) <span class="op">\</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">'CLOUDY_PIXEL_PERCENTAGE'</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    .select([<span class="st">'B8'</span>, <span class="st">'SCL'</span>,<span class="st">'B3'</span>,<span class="st">'B4'</span>,<span class="st">'B11'</span>])  <span class="co"># Select NIR band (B8) and Scene Classification Layer (SCL) for masking clouds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> sentinel_collection.size().getInfo()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of images in collection: </span><span class="sc">{</span>size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of images in collection: 1</code></pre>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a single band before retrieving the projection information</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>pixel_size <span class="op">=</span> sentinel_collection.first().select(<span class="st">'B8'</span>).projection().nominalScale().getInfo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the date information</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>image_info <span class="op">=</span> sentinel_collection.first().getInfo()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>image_date <span class="op">=</span> image_info[<span class="st">'properties'</span>][<span class="st">'system:time_start'</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>image_date_str <span class="op">=</span> pd.to_datetime(image_date, unit<span class="op">=</span><span class="st">'ms'</span>).strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>image_date_str <span class="op">=</span> <span class="st">"2024-11-06"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>image_date_str <span class="op">=</span> <span class="st">"2024-11-06"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="st">"0.22"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>false_color_filename_png <span class="op">=</span> <span class="ss">f"docs/reports/false_color_composite_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_png <span class="op">=</span> <span class="ss">f"docs/reports/flooded_pixels_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>false_color_filename_tif <span class="op">=</span> <span class="ss">f"docs/reports/false_color_composite_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.tif"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_tif <span class="op">=</span> <span class="ss">f"docs/reports/flooded_pixels_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.tif"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-27" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Image.<span class="bu">open</span>(false_color_filename_tif) <span class="im">as</span> img:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"False-color TIFF mode: </span><span class="sc">{</span>img<span class="sc">.</span>mode<span class="sc">}</span><span class="ss">, size: </span><span class="sc">{</span>img<span class="sc">.</span>size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        img.convert(<span class="st">"RGB"</span>).save(false_color_filename_png)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"False-color PNG saved at </span><span class="sc">{</span>false_color_filename_png<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error converting false-color TIFF to PNG: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Image.<span class="bu">open</span>(flooded_pixels_filename_tif) <span class="im">as</span> img:</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Flooded pixels TIFF mode: </span><span class="sc">{</span>img<span class="sc">.</span>mode<span class="sc">}</span><span class="ss">, size: </span><span class="sc">{</span>img<span class="sc">.</span>size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        img.convert(<span class="st">"RGB"</span>).save(flooded_pixels_filename_png)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Flooded pixels PNG saved at </span><span class="sc">{</span>flooded_pixels_filename_png<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error converting flooded pixels TIFF to PNG: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">The Kernel crashed while executing code in the current cell or a previous cell. 

</span><span class="ansi-red-fg ansi-bold">Please review the code in the cell(s) to identify a possible cause of the failure. 

</span><span class="ansi-red-fg ansi-bold">Click &lt;a href='https://aka.ms/vscodeJupyterKernelCrash'&gt;here&lt;/a&gt; for more info. 

</span><span class="ansi-red-fg ansi-bold">View Jupyter &lt;a href='command:jupyter.viewOutput'&gt;log&lt;/a&gt; for further details.</span></pre>
</div>
</div>
</div>
<p>report and map directories and file names</p>
<div id="cell-29" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># directory location for reports</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>html_subdirectory <span class="op">=</span> <span class="st">"flood_reports/html_reports_maps"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(html_subdirectory, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define filenames with unique names based on the image date</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>report_filename <span class="op">=</span> os.path.join(html_subdirectory, <span class="ss">f"bwma_flood_report_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.html"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>map_filename <span class="op">=</span> os.path.join(html_subdirectory, <span class="ss">f"flooded_area_map_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Create a cloud-free composite by masking cloudy pixels</p>
<div id="cell-31" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mask_clouds(image):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    cloud_prob <span class="op">=</span> image.select(<span class="st">'SCL'</span>)  <span class="co"># Scene Classification Layer (SCL)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    is_cloud <span class="op">=</span> cloud_prob.eq(<span class="dv">9</span>)  <span class="co"># 9 represents clouds in the SCL</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image.updateMask(is_cloud.Not())</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>cloud_free_composite <span class="op">=</span> sentinel_collection.<span class="bu">map</span>(mask_clouds).median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Define binary image base on the threshold</p>
<div id="cell-33" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>binary_image <span class="op">=</span> cloud_free_composite.select(<span class="st">'B8'</span>).divide(<span class="dv">10000</span>).lt(threshold).selfMask()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Load units from geojson and convert to earth engine geometry</p>
<div id="cell-35" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(<span class="st">"data/unitsBwma2800.geojson"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>units <span class="op">=</span> geemap.geopandas_to_ee(gdf)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>units <span class="op">=</span> units.filterBounds(bounding_box_geometry)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>units_clipped <span class="op">=</span> units.<span class="bu">map</span>(<span class="kw">lambda</span> feature: feature.intersection(bounding_box_geometry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Compute the unit area and flooded area</p>
<div id="cell-37" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute area of each unit</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_area(feature):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.<span class="bu">set</span>({<span class="st">'unit_acres'</span>: feature.geometry().area().divide(<span class="fl">4046.86</span>)})</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>units_with_area <span class="op">=</span> units_clipped.<span class="bu">map</span>(compute_area)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the flooded area within each unit</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_refined_flood_area(feature):</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    geom <span class="op">=</span> feature.geometry()</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    total_pixels <span class="op">=</span> cloud_free_composite.select(<span class="st">'B8'</span>).reduceRegion(</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        reducer<span class="op">=</span>ee.Reducer.count(), geometry<span class="op">=</span>geom, scale<span class="op">=</span><span class="dv">10</span>).get(<span class="st">'B8'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    flooded_pixels <span class="op">=</span> binary_image.reduceRegion(</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        reducer<span class="op">=</span>ee.Reducer.count(), geometry<span class="op">=</span>geom, scale<span class="op">=</span><span class="dv">10</span>).get(<span class="st">'B8'</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    pixel_area_m2 <span class="op">=</span> ee.Number(pixel_size).multiply(pixel_size)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    pixel_area_acres <span class="op">=</span> pixel_area_m2.multiply(<span class="fl">0.000247105</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    flooded_area_acres <span class="op">=</span> ee.Number(flooded_pixels).multiply(pixel_area_acres)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    flooded_percentage <span class="op">=</span> ee.Number(flooded_pixels).divide(total_pixels).multiply(<span class="dv">100</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    unit_name <span class="op">=</span> feature.get(<span class="st">'Flood_Unit'</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> ee.String(unit_name).cat(<span class="st">': '</span>).cat(flooded_area_acres.<span class="bu">format</span>(<span class="st">'</span><span class="sc">%.2f</span><span class="st">'</span>)).cat(<span class="st">' Acres'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.<span class="bu">set</span>({</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_pixels'</span>: total_pixels,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'flooded_pixels'</span>: flooded_pixels,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acres_flooded'</span>: flooded_area_acres,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'flooded_percentage'</span>: flooded_percentage,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'label'</span>: label</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>units_with_calculations <span class="op">=</span> units_with_area.<span class="bu">map</span>(compute_refined_flood_area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Convert EE feature collection to Pandas DataFrame</p>
<div id="cell-39" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.DataFrame(units_with_calculations.getInfo()[<span class="st">'features'</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.json_normalize(units_df_properties_reduced[<span class="st">'properties'</span>])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> units_df_properties_reduced[[<span class="st">'Flood_Unit'</span>, <span class="st">'total_pixels'</span>, <span class="st">'flooded_pixels'</span>, <span class="st">'unit_acres'</span>, <span class="st">'acres_flooded'</span>, <span class="st">'flooded_percentage'</span>]]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Round numbers</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> units_df_properties_reduced.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Calculate Total Acreage and add total row</p>
<div id="cell-41" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate totals</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>total_acres <span class="op">=</span> units_df_properties_reduced[<span class="st">'unit_acres'</span>].<span class="bu">sum</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>total_flooded_acres <span class="op">=</span> units_df_properties_reduced[<span class="st">'acres_flooded'</span>].<span class="bu">sum</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>total_flooded_percentage <span class="op">=</span> (total_flooded_acres <span class="op">/</span> total_acres) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a row for totals</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> pd.DataFrame([{</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Flood_Unit'</span>: <span class="st">'Total'</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_pixels'</span>: units_df_properties_reduced[<span class="st">'total_pixels'</span>].<span class="bu">sum</span>(),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'flooded_pixels'</span>: units_df_properties_reduced[<span class="st">'flooded_pixels'</span>].<span class="bu">sum</span>(),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'unit_acres'</span>: total_acres,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'acres_flooded'</span>: total_flooded_acres,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'flooded_percentage'</span>: total_flooded_percentage</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>}])</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate totals to the original dataframe</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.concat([units_df_properties_reduced, totals], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Round the totals row</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> units_df_properties_reduced.<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the formatted DataFrame</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(units_df_properties_reduced.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     Flood_Unit  total_pixels  flooded_pixels  unit_acres  acres_flooded  flooded_percentage
        Thibaut         99955            6526     1971.07         161.26                6.53
           Drew         25462             768      502.65          18.98                3.02
      Waggonner         63198            4429     1246.13         109.44                7.01
 West Winterton         40855            2080      805.68          51.40                5.09
 East Winterton         17010              19      335.14           0.47                0.11
South Winterton         26035            1337      513.46          33.04                5.14
  Thibaut Ponds         26753            1309      527.63          32.35                4.89
          Total        299268           16468     5901.76         406.94                6.90</code></pre>
</div>
</div>
<p>Create and Save HTML Map</p>
<div id="cell-43" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cloud_free_composite = sentinel_collection.map(lambda img: img.updateMask(img.select('SCL').neq(9))).median()</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#binary_image = cloud_free_composite.select('B8').divide(10000).lt(threshold).selfMask()</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define export file paths with date and threshold</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>false_color_filename_tif <span class="op">=</span> <span class="ss">f"docs/reports/false_color_composite_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.tif"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_tif <span class="op">=</span> <span class="ss">f"docs/reports/flooded_pixels_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.tif"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>false_color_filename_png <span class="op">=</span> <span class="ss">f"docs/reports/false_color_composite_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_png <span class="op">=</span> <span class="ss">f"docs/reports/flooded_pixels_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Export false-color composite as TIF with the correct bands</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>false_color_image <span class="op">=</span> cloud_free_composite.select([<span class="st">'B11'</span>, <span class="st">'B8'</span>, <span class="st">'B4'</span>]).visualize(<span class="op">**</span>false_color_vis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(false_color_image, filename<span class="op">=</span>false_color_filename_tif, scale<span class="op">=</span><span class="dv">10</span>, region<span class="op">=</span>bbox)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/thumbnails/cca305bcebf78bc407e668aa5a486d40-143f27f87326f62fdb0aa0bf1d16e281:getPixels
Please wait ...
Data downloaded to c:\Users\znelson\Documents\inyo-gov\flooded-acreage\docs\reports\false_color_composite_2024-10-22_0.21.tif</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Select the 'B8' band and multiply by 255 for visualization scaling</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>flooded_pixels_band <span class="op">=</span> binary_image.select(<span class="st">'B8'</span>).multiply(<span class="dv">255</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Rename the band to ensure compatibility with visualize</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>flooded_pixels_band <span class="op">=</span> flooded_pixels_band.rename([<span class="st">'visualized'</span>])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create the visualized image separately</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>flooded_pixels_visualized <span class="op">=</span> flooded_pixels_band.visualize(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    bands<span class="op">=</span>[<span class="st">'visualized'</span>],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>[<span class="st">'blue'</span>],</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">max</span><span class="op">=</span><span class="dv">255</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Export the visualized image</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(flooded_pixels_visualized, filename<span class="op">=</span>flooded_pixels_filename_tif, scale<span class="op">=</span><span class="dv">10</span>, region<span class="op">=</span>bbox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating URL ...
Downloading data from https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/thumbnails/0a8a39aa13ea87648748a473985daf7a-8bd8c61ea2cb58724b5e05482b195566:getPixels
Please wait ...
Data downloaded to c:\Users\znelson\Documents\inyo-gov\flooded-acreage\docs\reports\flooded_pixels_2024-10-22_0.21.tif</code></pre>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>false_color_filename_tif <span class="op">=</span> <span class="st">"docs/reports/false_color_composite_2024-11-03_0.23.tif"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_tif <span class="op">=</span> <span class="st">"docs/reports/flooded_pixels_2024-11-03_0.23.tif"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>false_color_filename_png <span class="op">=</span> <span class="st">"docs/reports/false_color_composite_2024-11-03_0.23.png"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>flooded_pixels_filename_png <span class="op">=</span> <span class="st">"docs/reports/flooded_pixels_2024-11-03_0.23.png"</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Image.<span class="bu">open</span>(false_color_filename_tif) <span class="im">as</span> img:</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        img.save(false_color_filename_png)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"False-color PNG created successfully."</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Image.<span class="bu">open</span>(flooded_pixels_filename_tif) <span class="im">as</span> img:</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        img.save(flooded_pixels_filename_png)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Flooded pixels PNG created successfully."</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error during TIF to PNG conversion: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">The Kernel crashed while executing code in the current cell or a previous cell. 

</span><span class="ansi-red-fg ansi-bold">Please review the code in the cell(s) to identify a possible cause of the failure. 

</span><span class="ansi-red-fg ansi-bold">Click &lt;a href='https://aka.ms/vscodeJupyterKernelCrash'&gt;here&lt;/a&gt; for more info. 

</span><span class="ansi-red-fg ansi-bold">View Jupyter &lt;a href='command:jupyter.viewOutput'&gt;log&lt;/a&gt; for further details.</span></pre>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(binary_image.getInfo())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>{'type': 'Image', 'bands': [{'id': 'B8', 'data_type': {'type': 'PixelType', 'precision': 'int', 'min': 0, 'max': 1}, 'crs': 'EPSG:4326', 'crs_transform': [1, 0, 0, 0, 1, 0]}]}</code></pre>
</div>
</div>
<div id="cell-48" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert TIF to PNG</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> Image.<span class="bu">open</span>(false_color_filename_tif) <span class="im">as</span> img:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    img.save(false_color_filename_png)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> Image.<span class="bu">open</span>(flooded_pixels_filename_tif) <span class="im">as</span> img:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    img.save(flooded_pixels_filename_png)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-49" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export false-color composite as TIF with the correct bands</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the cloud_free_composite with specific bands and visualize settings</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>false_color_image <span class="op">=</span> cloud_free_composite.select([<span class="st">'B11'</span>, <span class="st">'B8'</span>, <span class="st">'B4'</span>]).visualize(<span class="op">**</span>false_color_vis)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(false_color_image, filename<span class="op">=</span>false_color_filename_tif, scale<span class="op">=</span><span class="dv">10</span>, region<span class="op">=</span>bbox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[21], line 4</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># Export false-color composite as TIF with the correct bands</span>
<span class="ansi-green-fg">      2</span> <span style="font-style:italic;color:rgb(95,135,135)"># Use the cloud_free_composite with specific bands and visualize settings</span>
<span class="ansi-green-fg">      3</span> false_color_image <span style="color:rgb(98,98,98)">=</span> cloud_free_composite<span style="color:rgb(98,98,98)">.</span>select([<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">B11</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">B8</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">B4</span><span style="color:rgb(175,0,0)">'</span>])<span style="color:rgb(98,98,98)">.</span>visualize(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>false_color_vis)
<span class="ansi-green-fg ansi-bold">----&gt; 4</span> geemap<span style="color:rgb(98,98,98)">.</span>ee_export_image(false_color_image, filename<span style="color:rgb(98,98,98)">=</span><span class="ansi-yellow-bg">false_color_filename_tif</span>, scale<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">10</span>, region<span style="color:rgb(98,98,98)">=</span>bbox)

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'false_color_filename_tif' is not defined</pre>
</div>
</div>
</div>
<div id="cell-50" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Export flooded pixels as TIF with visualization parameters (ensure the 'B8' band is used)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This ensures that a proper color palette is applied to the binary mask</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>flooded_pixels_image <span class="op">=</span> binary_image.select(<span class="st">'B8'</span>).visualize({<span class="st">'palette'</span>: [<span class="st">'blue'</span>], <span class="st">'min'</span>: <span class="dv">0</span>, <span class="st">'max'</span>: <span class="dv">1</span>})</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>geemap.ee_export_image(flooded_pixels_image, filename<span class="op">=</span>flooded_pixels_filename_tif, scale<span class="op">=</span><span class="dv">10</span>, region<span class="op">=</span>bbox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-51" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define visualization parameters for a better false-color composite</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>false_color_vis <span class="op">=</span> {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min'</span>: <span class="dv">0</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max'</span>: <span class="dv">3000</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bands'</span>: [<span class="st">'B11'</span>, <span class="st">'B8'</span>, <span class="st">'B4'</span>],  <span class="co"># SWIR1 (B11), NIR (B8), Red (B4)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: <span class="fl">1.4</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Sentinel-2 image collection filtered by date, cloud cover, and bounds</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>sentinel_collection <span class="op">=</span> ee.ImageCollection(<span class="st">'COPERNICUS/S2_SR_HARMONIZED'</span>) <span class="op">\</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    .filterBounds(bounding_box_geometry) <span class="op">\</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    .filterDate(start_date, end_date) <span class="op">\</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">'CLOUDY_PIXEL_PERCENTAGE'</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    .select([<span class="st">'B8'</span>, <span class="st">'B11'</span>, <span class="st">'B4'</span>, <span class="st">'SCL'</span>])  <span class="co"># Select NIR (B8), SWIR1 (B11), Red (B4), and Scene Classification Layer (SCL)</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the binary image to the unit boundaries</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>clipped_binary_image <span class="op">=</span> binary_image.clip(units)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a folium map</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>Map <span class="op">=</span> geemap.Map(center<span class="op">=</span>[<span class="fl">36.8795</span>, <span class="op">-</span><span class="fl">118.202</span>], zoom<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the false-color composite to the map</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>Map.addLayer(sentinel_collection.median(), false_color_vis, <span class="st">'False-Color Composite'</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the clipped binary image to the map</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>Map.addLayer(clipped_binary_image, {<span class="st">'palette'</span>: [<span class="st">'blue'</span>], <span class="st">'opacity'</span>: <span class="fl">0.5</span>}, <span class="st">'Flooded Pixels'</span>)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Style for unit boundaries</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>units_style <span class="op">=</span> {<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'fillColor'</span>: <span class="st">'00000000'</span>}  <span class="co"># '00000000' is transparent in RGBA</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the unit boundaries to the map</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>Map.addLayer(units_with_calculations.style(<span class="op">**</span>units_style), {}, <span class="st">'Unit Boundaries'</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels to the map</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> units_with_calculations.aggregate_array(<span class="st">'label'</span>).getInfo()</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids for each feature</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_centroid(feature):</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.geometry().centroid().coordinates()</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> units_with_calculations.<span class="bu">map</span>(<span class="kw">lambda</span> f: f.<span class="bu">set</span>(<span class="st">'centroid'</span>, get_centroid(f)))</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the centroids information</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>centroid_info <span class="op">=</span> centroids.aggregate_array(<span class="st">'centroid'</span>).getInfo()</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, centroid <span class="kw">in</span> <span class="bu">zip</span>(labels, centroid_info):</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[centroid[<span class="dv">1</span>], centroid[<span class="dv">0</span>]],</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>label</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>    ).add_to(Map)</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map with Layer Control</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>Map.add_child(folium.LayerControl())</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the map to the subdirectory with a unique name</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>Map.save(map_filename)</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_24bbe59b4f413ee8156d93f30b679945 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/>
    <script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/>
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_24bbe59b4f413ee8156d93f30b679945&quot; ></div>
        
</body>
<script>
    
    
            var map_24bbe59b4f413ee8156d93f30b679945 = L.map(
                &quot;map_24bbe59b4f413ee8156d93f30b679945&quot;,
                {
                    center: [36.8795, -118.202],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    zoomControl: true,
                    preferCanvas: false,
                    eeInitialize: true,
                    addGoogleMap: false,
                    pluginLatlngpopup: false,
                    pluginFullscreen: true,
                    pluginDraw: true,
                    DrawExport: false,
                    pluginMinimap: false,
                    locateControl: false,
                    searchControl: true,
                    layersControl: true,
                }
            );

            

        
    
            var tile_layer_d069fcdd03d583d7cd73d6f8ed5139e0 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_d069fcdd03d583d7cd73d6f8ed5139e0.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            L.control.fullscreen(
                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            var options = {
              position: &quot;topleft&quot;,
              draw: {},
              edit: {},
            }
            // FeatureGroup is to store editable layers.
            var drawnItems_draw_control_a11b9124921cb71f318a65f03552bc37 = new L.featureGroup().addTo(
                map_24bbe59b4f413ee8156d93f30b679945
            );
            options.edit.featureGroup = drawnItems_draw_control_a11b9124921cb71f318a65f03552bc37;
            var draw_control_a11b9124921cb71f318a65f03552bc37 = new L.Control.Draw(
                options
            ).addTo( map_24bbe59b4f413ee8156d93f30b679945 );
            map_24bbe59b4f413ee8156d93f30b679945.on(L.Draw.Event.CREATED, function(e) {
                var layer = e.layer,
                    type = e.layerType;
                var coords = JSON.stringify(layer.toGeoJSON());
                layer.on('click', function() {
                    alert(coords);
                    console.log(coords);
                });
                drawnItems_draw_control_a11b9124921cb71f318a65f03552bc37.addLayer(layer);
             });
            map_24bbe59b4f413ee8156d93f30b679945.on('draw:created', function(e) {
                drawnItems_draw_control_a11b9124921cb71f318a65f03552bc37.addLayer(e.layer);
            });
            
        
    

            var geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320 = {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;, &quot;provider&quot;: &quot;nominatim&quot;, &quot;providerOptions&quot;: {}, &quot;zoom&quot;: 11};

            // note: geocoder name should start with lowercase
            var geocoderName_geocoder_b28882c90ccaf91d8687aa17f9815320 = geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320[&quot;provider&quot;];

            var customGeocoder_geocoder_b28882c90ccaf91d8687aa17f9815320 = L.Control.Geocoder[ geocoderName_geocoder_b28882c90ccaf91d8687aa17f9815320 ](
                geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320['providerOptions']
            );
            geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320[&quot;geocoder&quot;] = customGeocoder_geocoder_b28882c90ccaf91d8687aa17f9815320;

            L.Control.geocoder(
                geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320
            ).on('markgeocode', function(e) {
                var zoom = geocoderOpts_geocoder_b28882c90ccaf91d8687aa17f9815320['zoom'] || map_24bbe59b4f413ee8156d93f30b679945.getZoom();
                map_24bbe59b4f413ee8156d93f30b679945.setView(e.geocode.center, zoom);
            }).addTo(map_24bbe59b4f413ee8156d93f30b679945);

        
    
            map_24bbe59b4f413ee8156d93f30b679945.fitBounds(
                [[36.8795, -118.202], [36.8795, -118.202]],
                {&quot;maxZoom&quot;: 12}
            );
        
    
            var tile_layer_ca00a68ba1dab02521edb91998e629b9 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/4570e18e2c522e38805703949ec8f70b-46e3675f5c7d3a605e977ed093d8a72f/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_ca00a68ba1dab02521edb91998e629b9.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            var tile_layer_a4140c8ae313b45859b635488d8523f9 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/1a40c24f657fe9ed2fb38f466ca4463a-cf132e1e69d385fae9949a82a3d9f94b/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_a4140c8ae313b45859b635488d8523f9.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            var tile_layer_56f82c6639b6f67ce9d05cce89d2814b = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/bd173c087fcc9f940a96eed65d6bb362-7d8fe7576ccd103b8dcf47fa1310b58b/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_56f82c6639b6f67ce9d05cce89d2814b.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            var marker_03c5725eee381a97a7424fbab95fbad4 = L.marker(
                [36.86044066484152, -118.19616961810209],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_31cebf3cd6791c94aa7f27666b4daf26 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_95f31b0a35b591a45167fb35f01818d7 = $(`<div id=&quot;html_95f31b0a35b591a45167fb35f01818d7&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut: 161.26 Acres</div>`)[0];
                popup_31cebf3cd6791c94aa7f27666b4daf26.setContent(html_95f31b0a35b591a45167fb35f01818d7);
            
        

        marker_03c5725eee381a97a7424fbab95fbad4.bindPopup(popup_31cebf3cd6791c94aa7f27666b4daf26)
        ;

        
    
    
            var marker_9b664d959348921194d3d5b1305f5fe7 = L.marker(
                [36.91846697002981, -118.20809887168937],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_9b054d1ac8a764a2701f15eadba06b36 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_75b91de59db5add5f2e2081e397fc2a7 = $(`<div id=&quot;html_75b91de59db5add5f2e2081e397fc2a7&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Drew: 18.98 Acres</div>`)[0];
                popup_9b054d1ac8a764a2701f15eadba06b36.setContent(html_75b91de59db5add5f2e2081e397fc2a7);
            
        

        marker_9b664d959348921194d3d5b1305f5fe7.bindPopup(popup_9b054d1ac8a764a2701f15eadba06b36)
        ;

        
    
    
            var marker_83c85ede57d04aa68a34e64c1ba3ca5f = L.marker(
                [36.89979855072214, -118.19586436691745],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_7a81df0905eca97ab22a47a80dba7677 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_1b48a8023ccb659e30703d514325d280 = $(`<div id=&quot;html_1b48a8023ccb659e30703d514325d280&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Waggonner: 109.44 Acres</div>`)[0];
                popup_7a81df0905eca97ab22a47a80dba7677.setContent(html_1b48a8023ccb659e30703d514325d280);
            
        

        marker_83c85ede57d04aa68a34e64c1ba3ca5f.bindPopup(popup_7a81df0905eca97ab22a47a80dba7677)
        ;

        
    
    
            var marker_da1d52c603dfd28457e8bc4b8c43a4c9 = L.marker(
                [36.89781800267362, -118.21569918171215],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_dd2e80475e710f16bbeba107398e7067 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_21c8ada4bae9098ea1267c73fd4ae896 = $(`<div id=&quot;html_21c8ada4bae9098ea1267c73fd4ae896&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>West Winterton: 51.40 Acres</div>`)[0];
                popup_dd2e80475e710f16bbeba107398e7067.setContent(html_21c8ada4bae9098ea1267c73fd4ae896);
            
        

        marker_da1d52c603dfd28457e8bc4b8c43a4c9.bindPopup(popup_dd2e80475e710f16bbeba107398e7067)
        ;

        
    
    
            var marker_9fd9d876801ca22641300fc5abb7054a = L.marker(
                [36.90110531089543, -118.20920202369373],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_36f12c979b6b8e4872850429ead7b2d5 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_cce15b9435a5a8623e21b7286f752c04 = $(`<div id=&quot;html_cce15b9435a5a8623e21b7286f752c04&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>East Winterton: 0.47 Acres</div>`)[0];
                popup_36f12c979b6b8e4872850429ead7b2d5.setContent(html_cce15b9435a5a8623e21b7286f752c04);
            
        

        marker_9fd9d876801ca22641300fc5abb7054a.bindPopup(popup_36f12c979b6b8e4872850429ead7b2d5)
        ;

        
    
    
            var marker_b1445c38157a0eee4c73467be5123f20 = L.marker(
                [36.878012701624925, -118.20090485228432],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_1384d5e8e653c60f0e03afa220ea61db = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_0323e4f43d6bd78e9228ece0ce34831b = $(`<div id=&quot;html_0323e4f43d6bd78e9228ece0ce34831b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>South Winterton: 33.04 Acres</div>`)[0];
                popup_1384d5e8e653c60f0e03afa220ea61db.setContent(html_0323e4f43d6bd78e9228ece0ce34831b);
            
        

        marker_b1445c38157a0eee4c73467be5123f20.bindPopup(popup_1384d5e8e653c60f0e03afa220ea61db)
        ;

        
    
    
            var marker_036214931d06b114bc2d0de139010690 = L.marker(
                [36.87867846980565, -118.21664203614019],
                {}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
        var popup_7fa8a57095571f2e3951632d5835edc8 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_c529cbf2acd17475e21f231e5000d0dc = $(`<div id=&quot;html_c529cbf2acd17475e21f231e5000d0dc&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut Ponds: 32.35 Acres</div>`)[0];
                popup_7fa8a57095571f2e3951632d5835edc8.setContent(html_c529cbf2acd17475e21f231e5000d0dc);
            
        

        marker_036214931d06b114bc2d0de139010690.bindPopup(popup_7fa8a57095571f2e3951632d5835edc8)
        ;

        
    
    
            var layer_control_03d711e831d479b7421f96469e2435e5_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_d069fcdd03d583d7cd73d6f8ed5139e0,
                },
                overlays :  {
                    &quot;False-Color Composite&quot; : tile_layer_ca00a68ba1dab02521edb91998e629b9,
                    &quot;Flooded Pixels&quot; : tile_layer_a4140c8ae313b45859b635488d8523f9,
                    &quot;Unit Boundaries&quot; : tile_layer_56f82c6639b6f67ce9d05cce89d2814b,
                },
            };
            let layer_control_03d711e831d479b7421f96469e2435e5 = L.control.layers(
                layer_control_03d711e831d479b7421f96469e2435e5_layers.base_layers,
                layer_control_03d711e831d479b7421f96469e2435e5_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_24bbe59b4f413ee8156d93f30b679945);

        
    
            tile_layer_d069fcdd03d583d7cd73d6f8ed5139e0.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            tile_layer_ca00a68ba1dab02521edb91998e629b9.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            tile_layer_a4140c8ae313b45859b635488d8523f9.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
    
            tile_layer_56f82c6639b6f67ce9d05cce89d2814b.addTo(map_24bbe59b4f413ee8156d93f30b679945);
        
</script>
</html>" width="100%" height="600" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>false_color_vis <span class="op">=</span> {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min'</span>: <span class="dv">0</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max'</span>: <span class="dv">3000</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bands'</span>: [<span class="st">'B11'</span>, <span class="st">'B8'</span>, <span class="st">'B4'</span>],  <span class="co"># SWIR1 (B11), NIR (B8), Red (B4)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: <span class="fl">1.4</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Sentinel-2 image collection filtered by date, cloud cover, and bounds</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>sentinel_collection <span class="op">=</span> ee.ImageCollection(<span class="st">'COPERNICUS/S2_SR_HARMONIZED'</span>) <span class="op">\</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    .filterBounds(bounding_box_geometry) <span class="op">\</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    .filterDate(start_date, end_date) <span class="op">\</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">'CLOUDY_PIXEL_PERCENTAGE'</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    .select([<span class="st">'B8'</span>, <span class="st">'B11'</span>, <span class="st">'B4'</span>, <span class="st">'SCL'</span>])  <span class="co"># Select NIR (B8), SWIR1 (B11), Red (B4), and Scene Classification Layer (SCL)</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the binary image to the unit boundaries</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>clipped_binary_image <span class="op">=</span> binary_image.clip(units)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a folium map</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>Map <span class="op">=</span> geemap.Map(center<span class="op">=</span>[<span class="fl">36.8795</span>, <span class="op">-</span><span class="fl">118.202</span>], zoom<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the false-color image to the map (assuming 'image' is your Sentinel-2 or equivalent image)</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>Map.addLayer(image, false_color_vis, <span class="st">'False-Color Composite'</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the clipped binary image to the map</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>Map.addLayer(clipped_binary_image, {<span class="st">'palette'</span>: [<span class="st">'blue'</span>], <span class="st">'opacity'</span>: <span class="fl">0.5</span>}, <span class="st">'Flooded Pixels'</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Style for unit boundaries</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>units_style <span class="op">=</span> {<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'fillColor'</span>: <span class="st">'00000000'</span>}  <span class="co"># '00000000' is transparent in RGBA</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the unit boundaries to the map</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>Map.addLayer(units_with_calculations.style(<span class="op">**</span>units_style), {}, <span class="st">'Unit Boundaries'</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels to the map</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> units_with_calculations.aggregate_array(<span class="st">'label'</span>).getInfo()</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids for each feature</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_centroid(feature):</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.geometry().centroid().coordinates()</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> units_with_calculations.<span class="bu">map</span>(<span class="kw">lambda</span> f: f.<span class="bu">set</span>(<span class="st">'centroid'</span>, get_centroid(f)))</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the centroids information</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>centroid_info <span class="op">=</span> centroids.aggregate_array(<span class="st">'centroid'</span>).getInfo()</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, centroid <span class="kw">in</span> <span class="bu">zip</span>(labels, centroid_info):</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[centroid[<span class="dv">1</span>], centroid[<span class="dv">0</span>]],</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>label</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    ).add_to(Map)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map with Layer Control</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>Map.add_child(folium.LayerControl())</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the map to the subdirectory with a unique name</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>Map.save(map_filename)</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[19], line 23</span>
<span class="ansi-green-fg">     20</span> Map <span style="color:rgb(98,98,98)">=</span> geemap<span style="color:rgb(98,98,98)">.</span>Map(center<span style="color:rgb(98,98,98)">=</span>[<span style="color:rgb(98,98,98)">36.8795</span>, <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">118.202</span>], zoom<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">12</span>)
<span class="ansi-green-fg">     22</span> <span style="font-style:italic;color:rgb(95,135,135)"># Add the false-color image to the map (assuming 'image' is your Sentinel-2 or equivalent image)</span>
<span class="ansi-green-fg ansi-bold">---&gt; 23</span> Map<span style="color:rgb(98,98,98)">.</span>addLayer(<span class="ansi-yellow-bg">image</span>, false_color_vis, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">False-Color Composite</span><span style="color:rgb(175,0,0)">'</span>)
<span class="ansi-green-fg">     25</span> <span style="font-style:italic;color:rgb(95,135,135)"># Add the clipped binary image to the map</span>
<span class="ansi-green-fg">     26</span> Map<span style="color:rgb(98,98,98)">.</span>addLayer(clipped_binary_image, {<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">palette</span><span style="color:rgb(175,0,0)">'</span>: [<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">blue</span><span style="color:rgb(175,0,0)">'</span>], <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">opacity</span><span style="color:rgb(175,0,0)">'</span>: <span style="color:rgb(98,98,98)">0.5</span>}, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Flooded Pixels</span><span style="color:rgb(175,0,0)">'</span>)

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'image' is not defined</pre>
</div>
</div>
</div>
<div id="cell-53" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the binary image to the unit boundaries</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>clipped_binary_image <span class="op">=</span> binary_image.clip(units)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a folium map</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>Map <span class="op">=</span> geemap.Map(center<span class="op">=</span>[<span class="fl">36.8795</span>, <span class="op">-</span><span class="fl">118.202</span>], zoom<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the clipped binary image to the map</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Map.addLayer(clipped_binary_image, {<span class="st">'palette'</span>: [<span class="st">'blue'</span>], <span class="st">'opacity'</span>: <span class="fl">0.5</span>}, <span class="st">'Flooded Pixels'</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Style for unit boundaries</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>units_style <span class="op">=</span> {<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'fillColor'</span>: <span class="st">'00000000'</span>}  <span class="co"># '00000000' is transparent in RGBA</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the unit boundaries to the map</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>Map.addLayer(units_with_calculations.style(<span class="op">**</span>units_style), {}, <span class="st">'Unit Boundaries'</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels to the map</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> units_with_calculations.aggregate_array(<span class="st">'label'</span>).getInfo()</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids for each feature</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_centroid(feature):</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.geometry().centroid().coordinates()</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> units_with_calculations.<span class="bu">map</span>(<span class="kw">lambda</span> f: f.<span class="bu">set</span>(<span class="st">'centroid'</span>, get_centroid(f)))</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the centroids information</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>centroid_info <span class="op">=</span> centroids.aggregate_array(<span class="st">'centroid'</span>).getInfo()</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, centroid <span class="kw">in</span> <span class="bu">zip</span>(labels, centroid_info):</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[centroid[<span class="dv">1</span>], centroid[<span class="dv">0</span>]],</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>label</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    ).add_to(Map)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>Map.add_child(folium.LayerControl())</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the map to the subdirectory with a unique name</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>Map.save(map_filename)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_627d572cfc8aa660541755980b16d5b8 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/>
    <script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/>
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_627d572cfc8aa660541755980b16d5b8&quot; ></div>
        
</body>
<script>
    
    
            var map_627d572cfc8aa660541755980b16d5b8 = L.map(
                &quot;map_627d572cfc8aa660541755980b16d5b8&quot;,
                {
                    center: [36.8795, -118.202],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    zoomControl: true,
                    preferCanvas: false,
                    eeInitialize: true,
                    addGoogleMap: false,
                    pluginLatlngpopup: false,
                    pluginFullscreen: true,
                    pluginDraw: true,
                    DrawExport: false,
                    pluginMinimap: false,
                    locateControl: false,
                    searchControl: true,
                    layersControl: true,
                }
            );

            

        
    
            var tile_layer_42711bafc96c20d9823890e78aeb40e6 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_42711bafc96c20d9823890e78aeb40e6.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            L.control.fullscreen(
                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var options = {
              position: &quot;topleft&quot;,
              draw: {},
              edit: {},
            }
            // FeatureGroup is to store editable layers.
            var drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9 = new L.featureGroup().addTo(
                map_627d572cfc8aa660541755980b16d5b8
            );
            options.edit.featureGroup = drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9;
            var draw_control_354ce9ccbc70a56456264d10c3c366c9 = new L.Control.Draw(
                options
            ).addTo( map_627d572cfc8aa660541755980b16d5b8 );
            map_627d572cfc8aa660541755980b16d5b8.on(L.Draw.Event.CREATED, function(e) {
                var layer = e.layer,
                    type = e.layerType;
                var coords = JSON.stringify(layer.toGeoJSON());
                layer.on('click', function() {
                    alert(coords);
                    console.log(coords);
                });
                drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9.addLayer(layer);
             });
            map_627d572cfc8aa660541755980b16d5b8.on('draw:created', function(e) {
                drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9.addLayer(e.layer);
            });
            
        
    

            var geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8 = {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;, &quot;provider&quot;: &quot;nominatim&quot;, &quot;providerOptions&quot;: {}, &quot;zoom&quot;: 11};

            // note: geocoder name should start with lowercase
            var geocoderName_geocoder_cb1c547e54ef447a304308ecae69ffc8 = geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8[&quot;provider&quot;];

            var customGeocoder_geocoder_cb1c547e54ef447a304308ecae69ffc8 = L.Control.Geocoder[ geocoderName_geocoder_cb1c547e54ef447a304308ecae69ffc8 ](
                geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8['providerOptions']
            );
            geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8[&quot;geocoder&quot;] = customGeocoder_geocoder_cb1c547e54ef447a304308ecae69ffc8;

            L.Control.geocoder(
                geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8
            ).on('markgeocode', function(e) {
                var zoom = geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8['zoom'] || map_627d572cfc8aa660541755980b16d5b8.getZoom();
                map_627d572cfc8aa660541755980b16d5b8.setView(e.geocode.center, zoom);
            }).addTo(map_627d572cfc8aa660541755980b16d5b8);

        
    
            map_627d572cfc8aa660541755980b16d5b8.fitBounds(
                [[36.8795, -118.202], [36.8795, -118.202]],
                {&quot;maxZoom&quot;: 12}
            );
        
    
            var tile_layer_7fc230a1a7b190c1da0b1538fa14e294 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/d60854cfcdc3fdef1815fc9c62e55e21-93e342533442f1feb0bed5277baa0d1c/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_7fc230a1a7b190c1da0b1538fa14e294.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var tile_layer_3694564b2dbae984a7dfcf82feca929f = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/23a0ed8ecad8b8ea00012aca62ed1c38-90e335e22e332f65cb5fdf1abb5e852c/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_3694564b2dbae984a7dfcf82feca929f.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var marker_63a7b8ff6d3ca2418cca205c57447cb7 = L.marker(
                [36.86044066484152, -118.19616961810209],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_ef0c6a773377a93f806b61cf3ff8bcd4 = $(`<div id=&quot;html_ef0c6a773377a93f806b61cf3ff8bcd4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut: 64.05 Acres</div>`)[0];
                popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8.setContent(html_ef0c6a773377a93f806b61cf3ff8bcd4);
            
        

        marker_63a7b8ff6d3ca2418cca205c57447cb7.bindPopup(popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8)
        ;

        
    
    
            var marker_ba6940245e5eba7f2b34d20b41e1ff90 = L.marker(
                [36.91846697002981, -118.20809887168937],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_f5fb856cee50414b6bd960245f218441 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_aa9bde408adcce333a81407af668c1e3 = $(`<div id=&quot;html_aa9bde408adcce333a81407af668c1e3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Drew: 19.92 Acres</div>`)[0];
                popup_f5fb856cee50414b6bd960245f218441.setContent(html_aa9bde408adcce333a81407af668c1e3);
            
        

        marker_ba6940245e5eba7f2b34d20b41e1ff90.bindPopup(popup_f5fb856cee50414b6bd960245f218441)
        ;

        
    
    
            var marker_ab4eaa9c553f9d6aff08bbb6e4c05e7d = L.marker(
                [36.89979855072214, -118.19586436691745],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_0f86d28baa400470436dc4e615b51eac = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bdb7d60e2ed009b02e55c2b7e6e479c4 = $(`<div id=&quot;html_bdb7d60e2ed009b02e55c2b7e6e479c4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Waggonner: 30.00 Acres</div>`)[0];
                popup_0f86d28baa400470436dc4e615b51eac.setContent(html_bdb7d60e2ed009b02e55c2b7e6e479c4);
            
        

        marker_ab4eaa9c553f9d6aff08bbb6e4c05e7d.bindPopup(popup_0f86d28baa400470436dc4e615b51eac)
        ;

        
    
    
            var marker_696823d8e9ebc3e7643967d03df8066f = L.marker(
                [36.89781800267362, -118.21569918171215],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_6229292ded127022c0f78451aa3bf8e6 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2d55c2d09fc8b389f8f0eaca16e1aba6 = $(`<div id=&quot;html_2d55c2d09fc8b389f8f0eaca16e1aba6&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>West Winterton: 40.35 Acres</div>`)[0];
                popup_6229292ded127022c0f78451aa3bf8e6.setContent(html_2d55c2d09fc8b389f8f0eaca16e1aba6);
            
        

        marker_696823d8e9ebc3e7643967d03df8066f.bindPopup(popup_6229292ded127022c0f78451aa3bf8e6)
        ;

        
    
    
            var marker_5a2b5e662169c8e91b1fb717a5b9f772 = L.marker(
                [36.90110531089543, -118.20920202369373],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_94babad2a9c23c5238e06db93414a62c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_70d549ca73d2327819b51ad548bcb4a3 = $(`<div id=&quot;html_70d549ca73d2327819b51ad548bcb4a3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>East Winterton: 0.22 Acres</div>`)[0];
                popup_94babad2a9c23c5238e06db93414a62c.setContent(html_70d549ca73d2327819b51ad548bcb4a3);
            
        

        marker_5a2b5e662169c8e91b1fb717a5b9f772.bindPopup(popup_94babad2a9c23c5238e06db93414a62c)
        ;

        
    
    
            var marker_2b410129869c9dff6ea161180d4ba0ee = L.marker(
                [36.878012701624925, -118.20090485228432],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_4f992b15a5fe57a72d95eea6eab9b09f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_02ff9f0803c7f94749c4ee29726abcb4 = $(`<div id=&quot;html_02ff9f0803c7f94749c4ee29726abcb4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>South Winterton: 0.77 Acres</div>`)[0];
                popup_4f992b15a5fe57a72d95eea6eab9b09f.setContent(html_02ff9f0803c7f94749c4ee29726abcb4);
            
        

        marker_2b410129869c9dff6ea161180d4ba0ee.bindPopup(popup_4f992b15a5fe57a72d95eea6eab9b09f)
        ;

        
    
    
            var marker_e8babc668e1068210f4ab06bda30cc25 = L.marker(
                [36.87867846980565, -118.21664203614019],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_b5bc9350fb02b15244d9dc2664789319 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2d608b2216f7d4325be7cd86c8046e2b = $(`<div id=&quot;html_2d608b2216f7d4325be7cd86c8046e2b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut Ponds: 12.45 Acres</div>`)[0];
                popup_b5bc9350fb02b15244d9dc2664789319.setContent(html_2d608b2216f7d4325be7cd86c8046e2b);
            
        

        marker_e8babc668e1068210f4ab06bda30cc25.bindPopup(popup_b5bc9350fb02b15244d9dc2664789319)
        ;

        
    
    
            var layer_control_37fa84f125578758dde4770be39cdc8d_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_42711bafc96c20d9823890e78aeb40e6,
                },
                overlays :  {
                    &quot;Flooded Pixels&quot; : tile_layer_7fc230a1a7b190c1da0b1538fa14e294,
                    &quot;Unit Boundaries&quot; : tile_layer_3694564b2dbae984a7dfcf82feca929f,
                },
            };
            let layer_control_37fa84f125578758dde4770be39cdc8d = L.control.layers(
                layer_control_37fa84f125578758dde4770be39cdc8d_layers.base_layers,
                layer_control_37fa84f125578758dde4770be39cdc8d_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);

        
    
            tile_layer_42711bafc96c20d9823890e78aeb40e6.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            tile_layer_7fc230a1a7b190c1da0b1538fa14e294.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            tile_layer_3694564b2dbae984a7dfcf82feca929f.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
</script>
</html>" width="100%" height="600" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the binary image to the unit boundaries</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>clipped_binary_image <span class="op">=</span> binary_image.clip(units)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a folium map</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>Map <span class="op">=</span> geemap.Map(center<span class="op">=</span>[<span class="fl">36.8795</span>, <span class="op">-</span><span class="fl">118.202</span>], zoom<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the clipped binary image to the map</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>Map.addLayer(clipped_binary_image, {<span class="st">'palette'</span>: [<span class="st">'blue'</span>], <span class="st">'opacity'</span>: <span class="fl">0.5</span>}, <span class="st">'Flooded Pixels'</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Style for unit boundaries</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>units_style <span class="op">=</span> {<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'fillColor'</span>: <span class="st">'00000000'</span>}  <span class="co"># '00000000' is transparent in RGBA</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the unit boundaries to the map</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>Map.addLayer(units_with_calculations.style(<span class="op">**</span>units_style), {}, <span class="st">'Unit Boundaries'</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels to the map</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> units_with_calculations.aggregate_array(<span class="st">'label'</span>).getInfo()</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids for each feature</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_centroid(feature):</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature.geometry().centroid().coordinates()</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> units_with_calculations.<span class="bu">map</span>(<span class="kw">lambda</span> f: f.<span class="bu">set</span>(<span class="st">'centroid'</span>, get_centroid(f)))</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the centroids information</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>centroid_info <span class="op">=</span> centroids.aggregate_array(<span class="st">'centroid'</span>).getInfo()</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, centroid <span class="kw">in</span> <span class="bu">zip</span>(labels, centroid_info):</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[centroid[<span class="dv">1</span>], centroid[<span class="dv">0</span>]],</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>label</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    ).add_to(Map)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>Map.add_child(folium.LayerControl())</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the map to the subdirectory with a unique name</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>Map.save(map_filename)</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_627d572cfc8aa660541755980b16d5b8 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/>
    <script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/>
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_627d572cfc8aa660541755980b16d5b8&quot; ></div>
        
</body>
<script>
    
    
            var map_627d572cfc8aa660541755980b16d5b8 = L.map(
                &quot;map_627d572cfc8aa660541755980b16d5b8&quot;,
                {
                    center: [36.8795, -118.202],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    zoomControl: true,
                    preferCanvas: false,
                    eeInitialize: true,
                    addGoogleMap: false,
                    pluginLatlngpopup: false,
                    pluginFullscreen: true,
                    pluginDraw: true,
                    DrawExport: false,
                    pluginMinimap: false,
                    locateControl: false,
                    searchControl: true,
                    layersControl: true,
                }
            );

            

        
    
            var tile_layer_42711bafc96c20d9823890e78aeb40e6 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_42711bafc96c20d9823890e78aeb40e6.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            L.control.fullscreen(
                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var options = {
              position: &quot;topleft&quot;,
              draw: {},
              edit: {},
            }
            // FeatureGroup is to store editable layers.
            var drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9 = new L.featureGroup().addTo(
                map_627d572cfc8aa660541755980b16d5b8
            );
            options.edit.featureGroup = drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9;
            var draw_control_354ce9ccbc70a56456264d10c3c366c9 = new L.Control.Draw(
                options
            ).addTo( map_627d572cfc8aa660541755980b16d5b8 );
            map_627d572cfc8aa660541755980b16d5b8.on(L.Draw.Event.CREATED, function(e) {
                var layer = e.layer,
                    type = e.layerType;
                var coords = JSON.stringify(layer.toGeoJSON());
                layer.on('click', function() {
                    alert(coords);
                    console.log(coords);
                });
                drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9.addLayer(layer);
             });
            map_627d572cfc8aa660541755980b16d5b8.on('draw:created', function(e) {
                drawnItems_draw_control_354ce9ccbc70a56456264d10c3c366c9.addLayer(e.layer);
            });
            
        
    

            var geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8 = {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;, &quot;provider&quot;: &quot;nominatim&quot;, &quot;providerOptions&quot;: {}, &quot;zoom&quot;: 11};

            // note: geocoder name should start with lowercase
            var geocoderName_geocoder_cb1c547e54ef447a304308ecae69ffc8 = geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8[&quot;provider&quot;];

            var customGeocoder_geocoder_cb1c547e54ef447a304308ecae69ffc8 = L.Control.Geocoder[ geocoderName_geocoder_cb1c547e54ef447a304308ecae69ffc8 ](
                geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8['providerOptions']
            );
            geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8[&quot;geocoder&quot;] = customGeocoder_geocoder_cb1c547e54ef447a304308ecae69ffc8;

            L.Control.geocoder(
                geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8
            ).on('markgeocode', function(e) {
                var zoom = geocoderOpts_geocoder_cb1c547e54ef447a304308ecae69ffc8['zoom'] || map_627d572cfc8aa660541755980b16d5b8.getZoom();
                map_627d572cfc8aa660541755980b16d5b8.setView(e.geocode.center, zoom);
            }).addTo(map_627d572cfc8aa660541755980b16d5b8);

        
    
            map_627d572cfc8aa660541755980b16d5b8.fitBounds(
                [[36.8795, -118.202], [36.8795, -118.202]],
                {&quot;maxZoom&quot;: 12}
            );
        
    
            var tile_layer_7fc230a1a7b190c1da0b1538fa14e294 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/d60854cfcdc3fdef1815fc9c62e55e21-93e342533442f1feb0bed5277baa0d1c/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_7fc230a1a7b190c1da0b1538fa14e294.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var tile_layer_3694564b2dbae984a7dfcf82feca929f = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/ee-icwd-2023/maps/23a0ed8ecad8b8ea00012aca62ed1c38-90e335e22e332f65cb5fdf1abb5e852c/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_3694564b2dbae984a7dfcf82feca929f.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            var marker_63a7b8ff6d3ca2418cca205c57447cb7 = L.marker(
                [36.86044066484152, -118.19616961810209],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_ef0c6a773377a93f806b61cf3ff8bcd4 = $(`<div id=&quot;html_ef0c6a773377a93f806b61cf3ff8bcd4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut: 64.05 Acres</div>`)[0];
                popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8.setContent(html_ef0c6a773377a93f806b61cf3ff8bcd4);
            
        

        marker_63a7b8ff6d3ca2418cca205c57447cb7.bindPopup(popup_3522bd0072f8a7f3f9ce3f9c2fbe53a8)
        ;

        
    
    
            var marker_ba6940245e5eba7f2b34d20b41e1ff90 = L.marker(
                [36.91846697002981, -118.20809887168937],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_f5fb856cee50414b6bd960245f218441 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_aa9bde408adcce333a81407af668c1e3 = $(`<div id=&quot;html_aa9bde408adcce333a81407af668c1e3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Drew: 19.92 Acres</div>`)[0];
                popup_f5fb856cee50414b6bd960245f218441.setContent(html_aa9bde408adcce333a81407af668c1e3);
            
        

        marker_ba6940245e5eba7f2b34d20b41e1ff90.bindPopup(popup_f5fb856cee50414b6bd960245f218441)
        ;

        
    
    
            var marker_ab4eaa9c553f9d6aff08bbb6e4c05e7d = L.marker(
                [36.89979855072214, -118.19586436691745],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_0f86d28baa400470436dc4e615b51eac = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bdb7d60e2ed009b02e55c2b7e6e479c4 = $(`<div id=&quot;html_bdb7d60e2ed009b02e55c2b7e6e479c4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Waggonner: 30.00 Acres</div>`)[0];
                popup_0f86d28baa400470436dc4e615b51eac.setContent(html_bdb7d60e2ed009b02e55c2b7e6e479c4);
            
        

        marker_ab4eaa9c553f9d6aff08bbb6e4c05e7d.bindPopup(popup_0f86d28baa400470436dc4e615b51eac)
        ;

        
    
    
            var marker_696823d8e9ebc3e7643967d03df8066f = L.marker(
                [36.89781800267362, -118.21569918171215],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_6229292ded127022c0f78451aa3bf8e6 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2d55c2d09fc8b389f8f0eaca16e1aba6 = $(`<div id=&quot;html_2d55c2d09fc8b389f8f0eaca16e1aba6&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>West Winterton: 40.35 Acres</div>`)[0];
                popup_6229292ded127022c0f78451aa3bf8e6.setContent(html_2d55c2d09fc8b389f8f0eaca16e1aba6);
            
        

        marker_696823d8e9ebc3e7643967d03df8066f.bindPopup(popup_6229292ded127022c0f78451aa3bf8e6)
        ;

        
    
    
            var marker_5a2b5e662169c8e91b1fb717a5b9f772 = L.marker(
                [36.90110531089543, -118.20920202369373],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_94babad2a9c23c5238e06db93414a62c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_70d549ca73d2327819b51ad548bcb4a3 = $(`<div id=&quot;html_70d549ca73d2327819b51ad548bcb4a3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>East Winterton: 0.22 Acres</div>`)[0];
                popup_94babad2a9c23c5238e06db93414a62c.setContent(html_70d549ca73d2327819b51ad548bcb4a3);
            
        

        marker_5a2b5e662169c8e91b1fb717a5b9f772.bindPopup(popup_94babad2a9c23c5238e06db93414a62c)
        ;

        
    
    
            var marker_2b410129869c9dff6ea161180d4ba0ee = L.marker(
                [36.878012701624925, -118.20090485228432],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_4f992b15a5fe57a72d95eea6eab9b09f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_02ff9f0803c7f94749c4ee29726abcb4 = $(`<div id=&quot;html_02ff9f0803c7f94749c4ee29726abcb4&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>South Winterton: 0.77 Acres</div>`)[0];
                popup_4f992b15a5fe57a72d95eea6eab9b09f.setContent(html_02ff9f0803c7f94749c4ee29726abcb4);
            
        

        marker_2b410129869c9dff6ea161180d4ba0ee.bindPopup(popup_4f992b15a5fe57a72d95eea6eab9b09f)
        ;

        
    
    
            var marker_e8babc668e1068210f4ab06bda30cc25 = L.marker(
                [36.87867846980565, -118.21664203614019],
                {}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
        var popup_b5bc9350fb02b15244d9dc2664789319 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2d608b2216f7d4325be7cd86c8046e2b = $(`<div id=&quot;html_2d608b2216f7d4325be7cd86c8046e2b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>Thibaut Ponds: 12.45 Acres</div>`)[0];
                popup_b5bc9350fb02b15244d9dc2664789319.setContent(html_2d608b2216f7d4325be7cd86c8046e2b);
            
        

        marker_e8babc668e1068210f4ab06bda30cc25.bindPopup(popup_b5bc9350fb02b15244d9dc2664789319)
        ;

        
    
    
            var layer_control_37fa84f125578758dde4770be39cdc8d_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_42711bafc96c20d9823890e78aeb40e6,
                },
                overlays :  {
                    &quot;Flooded Pixels&quot; : tile_layer_7fc230a1a7b190c1da0b1538fa14e294,
                    &quot;Unit Boundaries&quot; : tile_layer_3694564b2dbae984a7dfcf82feca929f,
                },
            };
            let layer_control_37fa84f125578758dde4770be39cdc8d = L.control.layers(
                layer_control_37fa84f125578758dde4770be39cdc8d_layers.base_layers,
                layer_control_37fa84f125578758dde4770be39cdc8d_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_627d572cfc8aa660541755980b16d5b8);

        
    
            tile_layer_42711bafc96c20d9823890e78aeb40e6.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            tile_layer_7fc230a1a7b190c1da0b1538fa14e294.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
    
            tile_layer_3694564b2dbae984a7dfcf82feca929f.addTo(map_627d572cfc8aa660541755980b16d5b8);
        
</script>
</html>" width="100%" height="600" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<p>Write csv Table</p>
<div id="cell-56" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the subdirectory for CSV output</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>csv_subdirectory <span class="op">=</span> <span class="st">"flood_reports/csv_output"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>os.makedirs(csv_subdirectory, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the DataFrame to a CSV file</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.DataFrame(units_with_calculations.getInfo()[<span class="st">'features'</span>])</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.json_normalize(units_df_properties_reduced[<span class="st">'properties'</span>])</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> units_df_properties_reduced[[<span class="st">'Flood_Unit'</span>, <span class="st">'total_pixels'</span>, <span class="st">'flooded_pixels'</span>, <span class="st">'unit_acres'</span>, <span class="st">'acres_flooded'</span>]]</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the CSV filename with the new directory</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>csv_filename <span class="op">=</span> os.path.join(csv_subdirectory, <span class="ss">f'flood_report_data_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># csv_filename = f'flood_report_data_{image_date_str}.csv'</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced.to_csv(csv_filename, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Create HTML Table</p>
<div id="cell-58" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for display</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> units_df_properties_reduced[[<span class="st">'Flood_Unit'</span>, <span class="st">'acres_flooded'</span>]]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced.columns <span class="op">=</span> [<span class="st">'BWMA Unit'</span>, <span class="st">'Acres'</span>]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Round acres to whole numbers</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced[<span class="st">'Acres'</span>] <span class="op">=</span> units_df_properties_reduced[<span class="st">'Acres'</span>].<span class="bu">round</span>(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate totals</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>total_acres <span class="op">=</span> units_df_properties_reduced[<span class="st">'Acres'</span>].<span class="bu">sum</span>()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>totals_row <span class="op">=</span> pd.DataFrame([{<span class="st">'BWMA Unit'</span>: <span class="st">'Total'</span>, <span class="st">'Acres'</span>: total_acres}])</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Append the totals row to the DataFrame</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>units_df_properties_reduced <span class="op">=</span> pd.concat([units_df_properties_reduced, totals_row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Style the DataFrame and convert to HTML</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>html_table_simple <span class="op">=</span> (</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    units_df_properties_reduced.style</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    .set_table_styles([</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'selector'</span>: <span class="st">'th'</span>, <span class="st">'props'</span>: [(<span class="st">'text-align'</span>, <span class="st">'center'</span>), (<span class="st">'font-size'</span>, <span class="st">'14px'</span>)]},</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'selector'</span>: <span class="st">'td:nth-child(1)'</span>, <span class="st">'props'</span>: [(<span class="st">'text-align'</span>, <span class="st">'left'</span>), (<span class="st">'font-size'</span>, <span class="st">'12px'</span>)]},</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'selector'</span>: <span class="st">'td:nth-child(2)'</span>, <span class="st">'props'</span>: [(<span class="st">'text-align'</span>, <span class="st">'right'</span>), (<span class="st">'font-size'</span>, <span class="st">'12px'</span>)]},</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    .set_properties(subset<span class="op">=</span>pd.IndexSlice[units_df_properties_reduced.index[<span class="op">-</span><span class="dv">1</span>], :], <span class="op">**</span>{<span class="st">'font-weight'</span>: <span class="st">'bold'</span>, <span class="st">'font-size'</span>: <span class="st">'14px'</span>})</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    .hide(axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    .to_html()</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually hide the index in the HTML string</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>html_table_simple <span class="op">=</span> html_table_simple.replace(<span class="st">'&lt;th&gt;&lt;/th&gt;'</span>, <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<p>Create HTML Report</p>
<div id="cell-60" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># HTML report</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>html_report <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;BWMA Flooded Extent: </span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: Arial, sans-serif;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="ss">        .left </span><span class="ch">{{</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 25%;</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ss">        .right </span><span class="ch">{{</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 75%;</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2 </span><span class="ch">{{</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="ss">        .notes </span><span class="ch">{{</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 20px;</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px;</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #000;</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="ss">        /*----CHANGE---- Increase font size and add line above totals row */</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 90%;</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 50px;</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #ddd;</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: right;//from center</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 30px;</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="ss">        td:nth-child(2) </span><span class="ch">{{</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: right;</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:last-child </span><span class="ch">{{</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 80px;</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:last-child td </span><span class="ch">{{</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 3px solid #000;</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;h1&gt;BWMA Flooded Acres and Extent: </span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">&lt;/h1&gt;</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class="container"&gt;</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class="left"&gt;</span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h2&gt;Flooded Acres&lt;/h2&gt;</span></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="sc">{</span>html_table_simple<span class="sc">}</span></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class="right"&gt;</span></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h2&gt;Spatial Extent&lt;/h2&gt;</span></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Imagery Date: </span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">&lt;/p&gt;</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;iframe src="flooded_area_map_</span><span class="sc">{</span>image_date_str<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">.html" width="90%" height="500"&gt;&lt;/iframe&gt;</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class="notes"&gt;</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h3&gt;Technical Notes&lt;/h3&gt;</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;p&gt;Flooded acres were calculated from Sentinel-2 Surface Reflectance imagery using the Earth Engine Python API in a Jupyter notebook.  Sentinel-2 (S2) is a wide-swath, high-resolution, multispectral imaging mission with a global 5-day revisit frequency.&lt;/p&gt;</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;p&gt;The S2 Multispectral Instrument (MSI) samples 13 spectral bands: Visible and NIR at 10 meters, red edge and SWIR at 20 meters, and atmospheric bands at 60 meters spatial resolution. The Near Infrared (NIR) band was used to identify flooded areas by applying a threshold to isolate water.&lt;/p&gt;</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;p&gt;The results are validated during routine field checks throughout the seasonal flooding cycle September through April.&lt;/p&gt;</span></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;</span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the report to an HTML file in the subdirectory</span></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(report_filename, <span class="st">"w"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span>.write(html_report)</span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Report saved to </span><span class="sc">{</span>report_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Map saved to </span><span class="sc">{</span>map_filename<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Report saved to flood_reports/html_reports_maps\bwma_flood_report_2024-09-22_0.21.html
Map saved to flood_reports/html_reports_maps\flooded_area_map_2024-09-22_0.21.html</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>